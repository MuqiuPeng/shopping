generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id        String         @id @default(cuid())
  clerkId   String         @unique
  email     String         @unique
  firstName String?
  lastName  String?
  username  String?
  imageUrl  String?
  phone     String?
  role      String         @default("customer")
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  addresses Address[]
  cart      Cart?
  orders    Order[]
  reviews   Review[]
  wishlist  WishlistItem[]

  @@index([clerkId])
  @@index([email])
  @@map("customers")
}

model Address {
  id           String   @id @default(cuid())
  fullName     String
  phone        String
  addressLine1 String
  addressLine2 String?
  city         String
  state        String?
  postalCode   String
  country      String   @default("China")
  isDefault    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  customerId   String
  customer     Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  orders       Order[]

  @@index([customerId])
  @@map("addresses")
}

model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  slug        String    @unique
  description String?
  imageUrl    String?
  isActive    Boolean   @default(true)
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]

  @@index([slug])
  @@index([isActive])
  @@map("categories")
}

model Product {
  id                                                           String               @id @default(cuid())
  name                                                         String
  slug                                                         String               @unique
  description                                                  String?
  categoryId                                                   String?
  isActive                                                     Boolean              @default(true)
  isFeatured                                                   Boolean              @default(false)
  isNew                                                        Boolean              @default(false)
  metaTitle                                                    String?
  metaDescription                                              String?
  createdAt                                                    DateTime             @default(now())
  updatedAt                                                    DateTime             @updatedAt
  avgRating                                                    Decimal?             @db.Decimal(3, 2)
  publishedAt                                                  DateTime?
  reviewCount                                                  Int                  @default(0)
  salesCount                                                   Int                  @default(0)
  status                                                       ProductStatus        @default(DRAFT)
  thumbnail                                                    String?
  viewCount                                                    Int                  @default(0)
  wishlistCount                                                Int                  @default(0)
  product_faqs                                                 product_faqs[]
  images                                                       ProductImage[]
  product_tags                                                 product_tags[]
  product_variants                                             product_variants[]
  category                                                     Category?            @relation(fields: [categoryId], references: [id])
  promotion_products                                           promotion_products[]
  related_products_related_products_productIdToproducts        related_products[]   @relation("related_products_productIdToproducts")
  related_products_related_products_relatedProductIdToproducts related_products[]   @relation("related_products_relatedProductIdToproducts")
  reviews                                                      Review[]
  wishlistItems                                                WishlistItem[]

  @@index([slug])
  @@index([categoryId])
  @@index([isActive])
  @@index([isFeatured])
  @@index([avgRating])
  @@index([publishedAt])
  @@index([salesCount])
  @@index([status])
  @@index([viewCount])
  @@map("products")
}

model ProductImage {
  id        String   @id @default(cuid())
  productId String
  url       String
  altText   String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  isCover   Boolean  @default(false)
  publicId  String?
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("product_images")
}

model Cart {
  id         String     @id @default(cuid())
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  customerId String     @unique
  items      CartItem[]
  customer   Customer   @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@map("carts")
}

model CartItem {
  id               String           @id @default(cuid())
  cartId           String
  quantity         Int              @default(1)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  variantId        String
  cart             Cart             @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product_variants product_variants @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([cartId, variantId])
  @@index([cartId])
  @@index([variantId])
  @@map("cart_items")
}

model Order {
  id                   String        @id @default(cuid())
  orderNumber          String        @unique
  addressId            String?
  shippingFullName     String
  shippingPhone        String
  shippingAddressLine1 String
  shippingAddressLine2 String?
  shippingCity         String
  shippingState        String?
  shippingPostalCode   String
  shippingCountry      String
  subtotal             Decimal       @db.Decimal(10, 2)
  shippingCost         Decimal       @default(0) @db.Decimal(10, 2)
  tax                  Decimal       @default(0) @db.Decimal(10, 2)
  discount             Decimal       @default(0) @db.Decimal(10, 2)
  total                Decimal       @db.Decimal(10, 2)
  status               OrderStatus   @default(PENDING)
  paymentStatus        PaymentStatus @default(PENDING)
  paymentMethod        String?
  trackingNumber       String?
  shippedAt            DateTime?
  deliveredAt          DateTime?
  customerNote         String?
  adminNote            String?
  cancelledAt          DateTime?
  cancelReason         String?
  refundedAt           DateTime?
  refundAmount         Decimal?      @db.Decimal(10, 2)
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  customerId           String
  couponId             String?
  items                OrderItem[]
  address              Address?      @relation(fields: [addressId], references: [id])
  coupons              coupons?      @relation(fields: [couponId], references: [id])
  customer             Customer      @relation(fields: [customerId], references: [id])

  @@index([customerId])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
  @@index([couponId])
  @@map("orders")
}

model OrderItem {
  id               String           @id @default(cuid())
  orderId          String
  productName      String
  productSlug      String
  productImage     String?
  quantity         Int
  price            Decimal          @db.Decimal(10, 2)
  total            Decimal          @db.Decimal(10, 2)
  createdAt        DateTime         @default(now())
  variantId        String
  variantName      String?
  order            Order            @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product_variants product_variants @relation(fields: [variantId], references: [id])

  @@index([orderId])
  @@index([variantId])
  @@map("order_items")
}

model Review {
  id                 String   @id @default(cuid())
  productId          String
  rating             Int
  title              String?
  comment            String?
  isVerifiedPurchase Boolean  @default(false)
  isApproved         Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  customerId         String
  customer           Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  product            Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([productId])
  @@index([rating])
  @@index([isApproved])
  @@map("reviews")
}

model WishlistItem {
  id         String   @id @default(cuid())
  productId  String
  createdAt  DateTime @default(now())
  customerId String
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([customerId, productId])
  @@index([customerId])
  @@index([productId])
  @@map("wishlist_items")
}

model coupon_usages {
  id         String   @id
  couponId   String
  customerId String
  orderId    String?
  usedAt     DateTime @default(now())
  coupons    coupons  @relation(fields: [couponId], references: [id], onDelete: Cascade)

  @@index([couponId])
  @@index([customerId])
  @@index([orderId])
}

model coupons {
  id                    String          @id
  code                  String          @unique
  description           String?
  type                  CouponType
  value                 Decimal         @db.Decimal(10, 2)
  minPurchase           Decimal?        @db.Decimal(10, 2)
  maxDiscount           Decimal?        @db.Decimal(10, 2)
  usageLimit            Int?
  usageLimitPerCustomer Int?
  usageCount            Int             @default(0)
  startDate             DateTime
  endDate               DateTime
  isActive              Boolean         @default(true)
  createdAt             DateTime        @default(now())
  updatedAt             DateTime
  coupon_usages         coupon_usages[]
  orders                Order[]

  @@index([code])
  @@index([endDate])
  @@index([isActive])
  @@index([startDate])
}

model product_faqs {
  id        String   @id
  productId String
  question  String
  answer    String
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime
  products  Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([isActive])
  @@index([productId])
}

model product_tags {
  id        String   @id
  productId String
  tagId     String
  createdAt DateTime @default(now())
  products  Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  tags      tags     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([productId, tagId])
  @@index([productId])
  @@index([tagId])
}

model product_variants {
  id                 String               @id
  productId          String
  sku                String               @unique
  barcode            String?
  name               String?
  price              Decimal              @db.Decimal(10, 2)
  compareAtPrice     Decimal?             @db.Decimal(10, 2)
  cost               Decimal?             @db.Decimal(10, 2)
  inventory          Int                  @default(0)
  lowStockThreshold  Int                  @default(5)
  trackInventory     Boolean              @default(true)
  size               String?
  color              String?
  material           String?
  weight             Float?
  attributes         Json?
  isDefault          Boolean              @default(false)
  sortOrder          Int                  @default(0)
  isActive           Boolean              @default(true)
  salesCount         Int                  @default(0)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  cart_items         CartItem[]
  order_items        OrderItem[]
  products           Product              @relation(fields: [productId], references: [id], onDelete: Cascade)
  promotion_products promotion_products[]
  variant_images     variant_images[]

  @@index([isActive])
  @@index([productId])
  @@index([salesCount])
  @@index([sku])
}

model promotion_products {
  id               String            @id
  promotionId      String
  productId        String?
  variantId        String?
  createdAt        DateTime          @default(now())
  products         Product?          @relation(fields: [productId], references: [id], onDelete: Cascade)
  promotions       promotions        @relation(fields: [promotionId], references: [id], onDelete: Cascade)
  product_variants product_variants? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([promotionId])
  @@index([variantId])
}

model promotions {
  id                 String               @id
  name               String
  description        String?
  type               PromotionType
  value              Decimal              @db.Decimal(10, 2)
  startDate          DateTime
  endDate            DateTime
  isActive           Boolean              @default(true)
  minPurchase        Decimal?             @db.Decimal(10, 2)
  maxDiscount        Decimal?             @db.Decimal(10, 2)
  usageLimit         Int?
  usageCount         Int                  @default(0)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  promotion_products promotion_products[]

  @@index([endDate])
  @@index([isActive])
  @@index([startDate])
}

model related_products {
  id                                                   String       @id
  productId                                            String
  relatedProductId                                     String
  type                                                 RelationType @default(RELATED)
  sortOrder                                            Int          @default(0)
  createdAt                                            DateTime     @default(now())
  products_related_products_productIdToproducts        Product      @relation("related_products_productIdToproducts", fields: [productId], references: [id], onDelete: Cascade)
  products_related_products_relatedProductIdToproducts Product      @relation("related_products_relatedProductIdToproducts", fields: [relatedProductId], references: [id], onDelete: Cascade)

  @@unique([productId, relatedProductId])
  @@index([productId])
  @@index([type])
}

model tags {
  id           String         @id
  name         String         @unique
  slug         String         @unique
  description  String?
  color        String?
  isActive     Boolean        @default(true)
  createdBy    String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  product_tags product_tags[]

  @@index([createdBy])
  @@index([isActive])
  @@index([slug])
}

model variant_images {
  id               String           @id
  variantId        String
  url              String
  altText          String?
  sortOrder        Int              @default(0)
  createdAt        DateTime         @default(now())
  product_variants product_variants @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@index([variantId])
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum CouponType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_SHIPPING
}

enum ProductStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum PromotionType {
  PERCENTAGE
  FIXED_AMOUNT
  BUY_X_GET_Y
  FREE_SHIPPING
}

enum RelationType {
  RELATED
  UPSELL
  CROSS_SELL
}
