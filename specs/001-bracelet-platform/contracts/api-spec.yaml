openapi: 3.0.0
info:
  title: Bracelet Shopping Platform API
  version: 1.0.0
  description: REST API for beaded bracelet e-commerce platform with customer and admin interfaces
  contact:
    name: API Support
    email: dev@braceletshop.com

servers:
  - url: https://api.braceletshop.com/v1
    description: Production server
  - url: https://staging-api.braceletshop.com/v1
    description: Staging server
  - url: http://localhost:3000/api/v1
    description: Development server

security:
  - SessionAuth: []
  - ApiKey: []

paths:
  # Authentication Endpoints
  /auth/login:
    post:
      tags: [Authentication]
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
              required: [email, password]
      responses:
        200:
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        401:
          description: Invalid credentials
        400:
          description: Invalid request format

  /auth/register:
    post:
      tags: [Authentication]
      summary: Customer registration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
                name:
                  type: string
                  minLength: 2
                  maxLength: 50
              required: [email, password, name]
      responses:
        201:
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        409:
          description: Email already exists
        400:
          description: Invalid request format

  /auth/logout:
    post:
      tags: [Authentication]
      summary: User logout
      security:
        - SessionAuth: []
      responses:
        200:
          description: Logout successful
        401:
          description: Not authenticated

  # Product Endpoints
  /products:
    get:
      tags: [Products]
      summary: Get product catalog
      parameters:
        - name: category
          in: query
          schema:
            type: string
          description: Filter by category slug
        - name: material
          in: query
          schema:
            type: string
            enum: [PEARL, CRYSTAL_DIAMOND, MIXED]
          description: Filter by material type
        - name: minPrice
          in: query
          schema:
            type: integer
            minimum: 0
          description: Minimum price in cents
        - name: maxPrice
          in: query
          schema:
            type: integer
            minimum: 0
          description: Maximum price in cents
        - name: search
          in: query
          schema:
            type: string
          description: Search term for name/description
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Items per page
        - name: sort
          in: query
          schema:
            type: string
            enum: [newest, oldest, price_asc, price_desc, name_asc, name_desc]
            default: newest
          description: Sort order
      responses:
        200:
          description: Product list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  products:
                    type: array
                    items:
                      $ref: "#/components/schemas/Product"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
                  filters:
                    $ref: "#/components/schemas/ProductFilters"

  /products/{id}:
    get:
      tags: [Products]
      summary: Get product by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        200:
          description: Product details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductDetail"
        404:
          description: Product not found

  # Categories Endpoints
  /categories:
    get:
      tags: [Categories]
      summary: Get category hierarchy
      responses:
        200:
          description: Category tree
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Category"

  # Cart Endpoints
  /cart:
    get:
      tags: [Cart]
      summary: Get current cart
      responses:
        200:
          description: Cart contents
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"

    post:
      tags: [Cart]
      summary: Add item to cart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                productId:
                  type: string
                  format: uuid
                quantity:
                  type: integer
                  minimum: 1
              required: [productId, quantity]
      responses:
        200:
          description: Item added to cart
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"
        400:
          description: Invalid request or insufficient inventory
        404:
          description: Product not found

  /cart/items/{id}:
    put:
      tags: [Cart]
      summary: Update cart item quantity
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                quantity:
                  type: integer
                  minimum: 1
              required: [quantity]
      responses:
        200:
          description: Cart item updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"
        400:
          description: Insufficient inventory
        404:
          description: Cart item not found

    delete:
      tags: [Cart]
      summary: Remove item from cart
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        200:
          description: Item removed from cart
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"
        404:
          description: Cart item not found

  # Checkout Endpoints
  /checkout/session:
    post:
      tags: [Checkout]
      summary: Create checkout session
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                shippingAddress:
                  $ref: "#/components/schemas/Address"
                billingAddress:
                  $ref: "#/components/schemas/Address"
                sameAsShipping:
                  type: boolean
                  default: true
              required: [shippingAddress]
      responses:
        200:
          description: Checkout session created
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessionId:
                    type: string
                  clientSecret:
                    type: string
                  totalAmount:
                    type: integer
                  taxAmount:
                    type: integer
                  shippingAmount:
                    type: integer

  /checkout/complete:
    post:
      tags: [Checkout]
      summary: Complete order after payment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sessionId:
                  type: string
                paymentIntentId:
                  type: string
              required: [sessionId, paymentIntentId]
      responses:
        200:
          description: Order completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        400:
          description: Payment failed or session invalid

  # Orders Endpoints
  /orders:
    get:
      tags: [Orders]
      summary: Get customer order history
      security:
        - SessionAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum:
              [
                PENDING,
                PAID,
                PROCESSING,
                SHIPPED,
                DELIVERED,
                CANCELLED,
                REFUNDED,
              ]
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        200:
          description: Order history
          content:
            application/json:
              schema:
                type: object
                properties:
                  orders:
                    type: array
                    items:
                      $ref: "#/components/schemas/Order"
                  pagination:
                    $ref: "#/components/schemas/Pagination"

  /orders/{id}:
    get:
      tags: [Orders]
      summary: Get order details
      security:
        - SessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        200:
          description: Order details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderDetail"
        404:
          description: Order not found
        403:
          description: Not authorized to view this order

  # Admin Product Management
  /admin/products:
    get:
      tags: [Admin Products]
      summary: Get admin product list
      security:
        - SessionAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [ACTIVE, INACTIVE, DRAFT]
        - name: lowStock
          in: query
          schema:
            type: boolean
          description: Filter products with low inventory
        - name: search
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
      responses:
        200:
          description: Admin product list
          content:
            application/json:
              schema:
                type: object
                properties:
                  products:
                    type: array
                    items:
                      $ref: "#/components/schemas/AdminProduct"
                  pagination:
                    $ref: "#/components/schemas/Pagination"

    post:
      tags: [Admin Products]
      summary: Create new product
      security:
        - SessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateProduct"
      responses:
        201:
          description: Product created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminProduct"
        400:
          description: Invalid product data
        409:
          description: SKU already exists

  /admin/products/{id}:
    get:
      tags: [Admin Products]
      summary: Get admin product details
      security:
        - SessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        200:
          description: Admin product details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminProductDetail"
        404:
          description: Product not found

    put:
      tags: [Admin Products]
      summary: Update product
      security:
        - SessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProduct"
      responses:
        200:
          description: Product updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminProduct"
        400:
          description: Invalid product data
        404:
          description: Product not found

    delete:
      tags: [Admin Products]
      summary: Delete product
      security:
        - SessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        204:
          description: Product deleted
        404:
          description: Product not found
        400:
          description: Cannot delete product with existing orders

  # Admin Order Management
  /admin/orders:
    get:
      tags: [Admin Orders]
      summary: Get admin order list
      security:
        - SessionAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum:
              [
                PENDING,
                PAID,
                PROCESSING,
                SHIPPED,
                DELIVERED,
                CANCELLED,
                REFUNDED,
              ]
        - name: dateFrom
          in: query
          schema:
            type: string
            format: date
        - name: dateTo
          in: query
          schema:
            type: string
            format: date
        - name: search
          in: query
          schema:
            type: string
          description: Search by order number or customer email
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
      responses:
        200:
          description: Admin order list
          content:
            application/json:
              schema:
                type: object
                properties:
                  orders:
                    type: array
                    items:
                      $ref: "#/components/schemas/AdminOrder"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
                  summary:
                    $ref: "#/components/schemas/OrderSummary"

  /admin/orders/{id}:
    get:
      tags: [Admin Orders]
      summary: Get admin order details
      security:
        - SessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        200:
          description: Admin order details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminOrderDetail"
        404:
          description: Order not found

    patch:
      tags: [Admin Orders]
      summary: Update order status
      security:
        - SessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum:
                    [
                      PENDING,
                      PAID,
                      PROCESSING,
                      SHIPPED,
                      DELIVERED,
                      CANCELLED,
                      REFUNDED,
                    ]
                trackingNumber:
                  type: string
                notes:
                  type: string
                notifyCustomer:
                  type: boolean
                  default: true
              required: [status]
      responses:
        200:
          description: Order status updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminOrderDetail"
        400:
          description: Invalid status transition
        404:
          description: Order not found

  # Admin Analytics
  /admin/analytics/dashboard:
    get:
      tags: [Admin Analytics]
      summary: Get dashboard metrics
      security:
        - SessionAuth: []
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [7d, 30d, 90d, 1y]
            default: 30d
      responses:
        200:
          description: Dashboard metrics
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DashboardMetrics"

  /admin/analytics/sales:
    get:
      tags: [Admin Analytics]
      summary: Get sales analytics
      security:
        - SessionAuth: []
      parameters:
        - name: dateFrom
          in: query
          schema:
            type: string
            format: date
        - name: dateTo
          in: query
          schema:
            type: string
            format: date
        - name: groupBy
          in: query
          schema:
            type: string
            enum: [day, week, month]
            default: day
      responses:
        200:
          description: Sales analytics
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SalesAnalytics"

components:
  securitySchemes:
    SessionAuth:
      type: apiKey
      in: cookie
      name: next-auth.session-token
    ApiKey:
      type: apiKey
      in: header
      name: X-API-Key

  schemas:
    AuthResponse:
      type: object
      properties:
        user:
          $ref: "#/components/schemas/User"
        accessToken:
          type: string
        refreshToken:
          type: string

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        role:
          type: string
          enum: [CUSTOMER, ADMIN]
        image:
          type: string
          format: uri
        createdAt:
          type: string
          format: date-time

    Product:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        shortDescription:
          type: string
        price:
          type: integer
          description: Price in cents
        compareAtPrice:
          type: integer
          description: Original price in cents
        material:
          type: string
          enum: [PEARL, CRYSTAL_DIAMOND, MIXED]
        style:
          type: string
        primaryImage:
          $ref: "#/components/schemas/ProductImage"
        inStock:
          type: boolean

    ProductDetail:
      allOf:
        - $ref: "#/components/schemas/Product"
        - type: object
          properties:
            description:
              type: string
            sku:
              type: string
            size:
              type: string
            weight:
              type: number
            images:
              type: array
              items:
                $ref: "#/components/schemas/ProductImage"
            categories:
              type: array
              items:
                $ref: "#/components/schemas/Category"
            inventory:
              type: object
              properties:
                quantity:
                type: integer
                inStock:
                  type: boolean

    ProductImage:
      type: object
      properties:
        id:
          type: string
          format: uuid
        url:
          type: string
          format: uri
        altText:
          type: string
        width:
          type: integer
        height:
          type: integer
        isPrimary:
          type: boolean

    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string
        description:
          type: string
        children:
          type: array
          items:
            $ref: "#/components/schemas/Category"

    Cart:
      type: object
      properties:
        id:
          type: string
          format: uuid
        items:
          type: array
          items:
            $ref: "#/components/schemas/CartItem"
        subtotal:
          type: integer
          description: Subtotal in cents
        itemCount:
          type: integer
        updatedAt:
          type: string
          format: date-time

    CartItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        product:
          $ref: "#/components/schemas/Product"
        quantity:
          type: integer
        unitPrice:
          type: integer
          description: Price per item in cents
        totalPrice:
          type: integer
          description: Total price in cents

    Address:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        company:
          type: string
        address1:
          type: string
        address2:
          type: string
        city:
          type: string
        state:
          type: string
        postalCode:
          type: string
        country:
          type: string
        phone:
          type: string
      required:
        [firstName, lastName, address1, city, state, postalCode, country]

    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
        orderNumber:
          type: string
        status:
          type: string
          enum:
            [PENDING, PAID, PROCESSING, SHIPPED, DELIVERED, CANCELLED, REFUNDED]
        totalAmount:
          type: integer
        subtotalAmount:
          type: integer
        taxAmount:
          type: integer
        shippingAmount:
          type: integer
        currency:
          type: string
        createdAt:
          type: string
          format: date-time

    OrderDetail:
      allOf:
        - $ref: "#/components/schemas/Order"
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/OrderItem"
            shippingAddress:
              $ref: "#/components/schemas/Address"
            billingAddress:
              $ref: "#/components/schemas/Address"
            trackingNumber:
              type: string
            statusHistory:
              type: array
              items:
                $ref: "#/components/schemas/OrderStatusHistory"

    OrderItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        product:
          $ref: "#/components/schemas/Product"
        quantity:
          type: integer
        unitPrice:
          type: integer
        totalPrice:
          type: integer

    OrderStatusHistory:
      type: object
      properties:
        fromStatus:
          type: string
        toStatus:
          type: string
        notes:
          type: string
        customerNotified:
          type: boolean
        createdAt:
          type: string
          format: date-time

    AdminProduct:
      allOf:
        - $ref: "#/components/schemas/ProductDetail"
        - type: object
          properties:
            status:
              type: string
              enum: [ACTIVE, INACTIVE, DRAFT]
            inventory:
              type: object
              properties:
                quantity:
                  type: integer
                reservedQuantity:
                  type: integer
                reorderPoint:
                  type: integer
                isLowStock:
                  type: boolean

    AdminProductDetail:
      allOf:
        - $ref: "#/components/schemas/AdminProduct"
        - type: object
          properties:
            seoTitle:
              type: string
            seoDescription:
              type: string
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time

    CreateProduct:
      type: object
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
        description:
          type: string
          minLength: 10
          maxLength: 2000
        shortDescription:
          type: string
          maxLength: 200
        sku:
          type: string
          pattern: "^[A-Z0-9-]+$"
        price:
          type: integer
          minimum: 1
        compareAtPrice:
          type: integer
          minimum: 1
        material:
          type: string
          enum: [PEARL, CRYSTAL_DIAMOND, MIXED]
        style:
          type: string
        size:
          type: string
        weight:
          type: number
        categoryIds:
          type: array
          items:
            type: string
            format: uuid
        initialInventory:
          type: integer
          minimum: 0
        reorderPoint:
          type: integer
          minimum: 0
        status:
          type: string
          enum: [ACTIVE, INACTIVE, DRAFT]
          default: DRAFT
      required:
        [
          name,
          description,
          sku,
          price,
          material,
          style,
          initialInventory,
          reorderPoint,
        ]

    UpdateProduct:
      type: object
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
        description:
          type: string
          minLength: 10
          maxLength: 2000
        shortDescription:
          type: string
          maxLength: 200
        price:
          type: integer
          minimum: 1
        compareAtPrice:
          type: integer
          minimum: 1
        material:
          type: string
          enum: [PEARL, CRYSTAL_DIAMOND, MIXED]
        style:
          type: string
        size:
          type: string
        weight:
          type: number
        categoryIds:
          type: array
          items:
            type: string
            format: uuid
        status:
          type: string
          enum: [ACTIVE, INACTIVE, DRAFT]
        seoTitle:
          type: string
        seoDescription:
          type: string

    AdminOrder:
      allOf:
        - $ref: "#/components/schemas/Order"
        - type: object
          properties:
            customerEmail:
              type: string
              format: email
            customerName:
              type: string
            itemCount:
              type: integer
            paymentStatus:
              type: string
              enum: [PENDING, PAID, FAILED, REFUNDED]

    AdminOrderDetail:
      allOf:
        - $ref: "#/components/schemas/OrderDetail"
        - type: object
          properties:
            customerEmail:
              type: string
            customerPhone:
              type: string
            paymentStatus:
              type: string
            paymentIntentId:
              type: string
            notes:
              type: string
            adminNotes:
              type: string

    DashboardMetrics:
      type: object
      properties:
        revenue:
          type: object
          properties:
            current:
              type: integer
            previous:
              type: integer
            growth:
              type: number
        orders:
          type: object
          properties:
            current:
              type: integer
            previous:
              type: integer
            growth:
              type: number
        customers:
          type: object
          properties:
            total:
              type: integer
            new:
              type: integer
            returning:
              type: integer
        products:
          type: object
          properties:
            total:
              type: integer
            lowStock:
              type: integer
            outOfStock:
              type: integer
        topProducts:
          type: array
          items:
            type: object
            properties:
              product:
                $ref: "#/components/schemas/Product"
              sales:
                type: integer
              revenue:
                type: integer

    SalesAnalytics:
      type: object
      properties:
        period:
          type: object
          properties:
            from:
              type: string
              format: date
            to:
              type: string
              format: date
        data:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              revenue:
                type: integer
              orders:
                type: integer
              customers:
                type: integer
        totals:
          type: object
          properties:
            revenue:
              type: integer
            orders:
              type: integer
            averageOrderValue:
              type: integer

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer
        hasNext:
          type: boolean
        hasPrev:
          type: boolean

    ProductFilters:
      type: object
      properties:
        materials:
          type: array
          items:
            type: object
            properties:
              value:
                type: string
              label:
                type: string
              count:
                type: integer
        priceRanges:
          type: array
          items:
            type: object
            properties:
              min:
                type: integer
              max:
                type: integer
              label:
                type: string
              count:
                type: integer
        categories:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              name:
                type: string
              count:
                type: integer

    OrderSummary:
      type: object
      properties:
        totalRevenue:
          type: integer
        totalOrders:
          type: integer
        averageOrderValue:
          type: integer
        statusBreakdown:
          type: object
          additionalProperties:
            type: integer

    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        code:
          type: string
        details:
          type: object

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Products
    description: Product catalog and search
  - name: Categories
    description: Product categories and navigation
  - name: Cart
    description: Shopping cart management
  - name: Checkout
    description: Order checkout and payment
  - name: Orders
    description: Customer order history
  - name: Admin Products
    description: Administrative product management
  - name: Admin Orders
    description: Administrative order management
  - name: Admin Analytics
    description: Business analytics and reporting
