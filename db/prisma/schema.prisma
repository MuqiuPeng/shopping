generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model addresses {
  id           String    @id
  fullName     String
  phone        String
  addressLine1 String
  addressLine2 String?
  city         String
  state        String?
  postalCode   String
  country      String    @default("China")
  isDefault    Boolean   @default(false)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  customerId   String
  customers    customers @relation(fields: [customerId], references: [id], onDelete: Cascade)
  orders       orders[]

  @@index([customerId])
}

model cart_items {
  id        String           @id @default(cuid())
  cartId    String
  quantity  Int              @default(1)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  variantId String
  carts     carts            @relation(fields: [cartId], references: [id], onDelete: Cascade)
  variant   product_variants @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([cartId, variantId])
  @@index([cartId])
  @@index([variantId])
}

model carts {
  id         String       @id @default(cuid())
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  customerId String       @unique
  items      cart_items[]
  customer   customers    @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

model categories {
  id            String               @id
  name          String               @unique
  slug          String               @unique
  description   String?
  imageUrl      String?
  isActive      Boolean              @default(true)
  sortOrder     Int                  @default(0)
  createdAt     DateTime             @default(now())
  updatedAt     DateTime
  parentId      String?
  path          String               @default("")
  allowChildren Boolean              @default(true)
  isProtected   Boolean              @default(false)
  parent        categories?          @relation("CategoryToParent", fields: [parentId], references: [id])
  children      categories[]         @relation("CategoryToParent")
  products      product_categories[]

  @@index([isActive])
  @@index([slug])
}

model customers {
  id             String           @id @default(cuid())
  clerkId        String           @unique
  email          String           @unique
  firstName      String?
  lastName       String?
  username       String?
  imageUrl       String?
  phone          String?
  role           String           @default("customer")
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  addresses      addresses[]
  carts          carts?
  orders         orders[]
  reviews        reviews[]
  wishlist_items wishlist_items[]

  @@index([clerkId])
  @@index([email])
}

model order_items {
  id           String           @id
  orderId      String
  productName  String
  productSlug  String
  productImage String?
  quantity     Int
  price        Decimal          @db.Decimal(10, 2)
  total        Decimal          @db.Decimal(10, 2)
  createdAt    DateTime         @default(now())
  variantId    String
  variantName  String?
  orders       orders           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  variant      product_variants @relation(fields: [variantId], references: [id])

  @@index([orderId])
  @@index([variantId])
}

model orders {
  id                   String        @id
  orderNumber          String        @unique
  addressId            String?
  shippingFullName     String
  shippingPhone        String
  shippingAddressLine1 String
  shippingAddressLine2 String?
  shippingCity         String
  shippingState        String?
  shippingPostalCode   String
  shippingCountry      String
  subtotal             Decimal       @db.Decimal(10, 2)
  shippingCost         Decimal       @default(0) @db.Decimal(10, 2)
  tax                  Decimal       @default(0) @db.Decimal(10, 2)
  discount             Decimal       @default(0) @db.Decimal(10, 2)
  total                Decimal       @db.Decimal(10, 2)
  status               OrderStatus   @default(PENDING)
  paymentStatus        PaymentStatus @default(PENDING)
  paymentMethod        String?
  trackingNumber       String?
  shippedAt            DateTime?
  deliveredAt          DateTime?
  customerNote         String?
  adminNote            String?
  cancelledAt          DateTime?
  cancelReason         String?
  refundedAt           DateTime?
  refundAmount         Decimal?      @db.Decimal(10, 2)
  createdAt            DateTime      @default(now())
  updatedAt            DateTime
  customerId           String
  couponId             String?
  order_items          order_items[]
  addresses            addresses?    @relation(fields: [addressId], references: [id])
  coupons              coupons?      @relation(fields: [couponId], references: [id])
  customers            customers     @relation(fields: [customerId], references: [id])

  @@index([createdAt])
  @@index([customerId])
  @@index([orderNumber])
  @@index([status])
  @@index([couponId])
}

model product_images {
  id        String   @id
  productId String
  url       String
  altText   String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  isCover   Boolean  @default(false)
  publicId  String?
  products  products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

model products {
  id                 String               @id @default(uuid())
  name               String
  slug               String               @unique
  description        String?
  isActive           Boolean              @default(true)
  isFeatured         Boolean              @default(false)
  isNew              Boolean              @default(false)
  metaTitle          String?
  metaDescription    String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  avgRating          Decimal?             @db.Decimal(3, 2)
  publishedAt        DateTime?
  reviewCount        Int                  @default(0)
  salesCount         Int                  @default(0)
  status             ProductStatus        @default(DRAFT)
  thumbnail          String?
  viewCount          Int                  @default(0)
  wishlistCount      Int                  @default(0)
  categories         product_categories[]
  product_faqs       product_faqs[]
  product_images     product_images[]
  product_tags       product_tags[]
  variants           product_variants[]
  promotion_products promotion_products[]
  related_from       related_products[]   @relation("ProductRelations")
  related_to         related_products[]   @relation("RelatedToProduct")
  reviews            reviews[]
  wishlist_items     wishlist_items[]

  @@index([status])
  @@index([isActive])
  @@index([isFeatured])
  @@index([slug])
  @@index([publishedAt])
  @@index([salesCount])
  @@index([avgRating])
  @@index([viewCount])
}

model product_categories {
  productId  String
  categoryId String
  isPrimary  Boolean    @default(false)
  sortOrder  Int        @default(0)
  createdAt  DateTime   @default(now())
  category   categories @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  product    products   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@id([productId, categoryId])
  @@index([productId])
  @@index([categoryId])
  @@index([isPrimary])
}

model product_variants {
  id                 String               @id @default(uuid())
  productId          String
  sku                String               @unique
  barcode            String?
  name               String?
  price              Decimal              @db.Decimal(10, 2)
  compareAtPrice     Decimal?             @db.Decimal(10, 2)
  cost               Decimal?             @db.Decimal(10, 2)
  inventory          Int                  @default(0)
  lowStockThreshold  Int                  @default(5)
  trackInventory     Boolean              @default(true)
  size               String?
  color              String?
  material           String?
  weight             Float?
  attributes         Json?
  isDefault          Boolean              @default(false)
  sortOrder          Int                  @default(0)
  isActive           Boolean              @default(true)
  salesCount         Int                  @default(0)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  cart_items         cart_items[]
  order_items        order_items[]
  product            products             @relation(fields: [productId], references: [id], onDelete: Cascade)
  promotion_products promotion_products[]
  variant_images     variant_images[]

  @@index([productId])
  @@index([sku])
  @@index([isActive])
  @@index([salesCount])
}

model variant_images {
  id        String           @id @default(uuid())
  variantId String
  url       String
  altText   String?
  sortOrder Int              @default(0)
  createdAt DateTime         @default(now())
  variant   product_variants @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@index([variantId])
}

model reviews {
  id                 String    @id
  productId          String
  rating             Int
  title              String?
  comment            String?
  isVerifiedPurchase Boolean   @default(false)
  isApproved         Boolean   @default(false)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  customerId         String
  customers          customers @relation(fields: [customerId], references: [id], onDelete: Cascade)
  products           products  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([isApproved])
  @@index([productId])
  @@index([rating])
}

model wishlist_items {
  id         String    @id
  productId  String
  createdAt  DateTime  @default(now())
  customerId String
  customers  customers @relation(fields: [customerId], references: [id], onDelete: Cascade)
  products   products  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([customerId, productId])
  @@index([customerId])
  @@index([productId])
}

model tags {
  id           String         @id @default(uuid())
  name         String?        @unique
  slug         String         @unique
  description  String?
  color        String?
  isActive     Boolean        @default(true)
  createdBy    String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  product_tags product_tags[]

  @@index([slug])
  @@index([isActive])
  @@index([createdBy])
}

model product_tags {
  id        String   @id @default(uuid())
  productId String
  tagId     String
  createdAt DateTime @default(now())
  products  products @relation(fields: [productId], references: [id], onDelete: Cascade)
  tags      tags     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([productId, tagId])
  @@index([productId])
  @@index([tagId])
}

model promotions {
  id                 String               @id @default(uuid())
  name               String
  description        String?
  type               PromotionType
  value              Decimal              @db.Decimal(10, 2)
  startDate          DateTime
  endDate            DateTime
  isActive           Boolean              @default(true)
  minPurchase        Decimal?             @db.Decimal(10, 2)
  maxDiscount        Decimal?             @db.Decimal(10, 2)
  usageLimit         Int?
  usageCount         Int                  @default(0)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  promotion_products promotion_products[]

  @@index([isActive])
  @@index([startDate])
  @@index([endDate])
}

model promotion_products {
  id          String            @id @default(uuid())
  promotionId String
  productId   String?
  variantId   String?
  createdAt   DateTime          @default(now())
  product     products?         @relation(fields: [productId], references: [id], onDelete: Cascade)
  promotion   promotions        @relation(fields: [promotionId], references: [id], onDelete: Cascade)
  variant     product_variants? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@index([promotionId])
  @@index([productId])
  @@index([variantId])
}

model coupons {
  id                    String          @id @default(uuid())
  code                  String          @unique
  description           String?
  type                  CouponType
  value                 Decimal         @db.Decimal(10, 2)
  minPurchase           Decimal?        @db.Decimal(10, 2)
  maxDiscount           Decimal?        @db.Decimal(10, 2)
  usageLimit            Int?
  usageLimitPerCustomer Int?
  usageCount            Int             @default(0)
  startDate             DateTime
  endDate               DateTime
  isActive              Boolean         @default(true)
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt
  coupon_usages         coupon_usages[]
  orders                orders[]

  @@index([code])
  @@index([isActive])
  @@index([startDate])
  @@index([endDate])
}

model coupon_usages {
  id         String   @id @default(uuid())
  couponId   String
  customerId String
  orderId    String?
  usedAt     DateTime @default(now())
  coupon     coupons  @relation(fields: [couponId], references: [id], onDelete: Cascade)

  @@index([couponId])
  @@index([customerId])
  @@index([orderId])
}

model product_faqs {
  id        String   @id @default(uuid())
  productId String
  question  String
  answer    String
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([isActive])
}

model related_products {
  id               String       @id @default(uuid())
  productId        String
  relatedProductId String
  type             RelationType @default(RELATED)
  sortOrder        Int          @default(0)
  createdAt        DateTime     @default(now())
  product          products     @relation("ProductRelations", fields: [productId], references: [id], onDelete: Cascade)
  relatedProduct   products     @relation("RelatedToProduct", fields: [relatedProductId], references: [id], onDelete: Cascade)

  @@unique([productId, relatedProductId])
  @@index([productId])
  @@index([type])
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
  UNKNOWN
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  UNKNOWN
}

enum ProductStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum PromotionType {
  PERCENTAGE
  FIXED_AMOUNT
  BUY_X_GET_Y
  FREE_SHIPPING
}

enum CouponType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_SHIPPING
}

enum RelationType {
  RELATED
  UPSELL
  CROSS_SELL
}
